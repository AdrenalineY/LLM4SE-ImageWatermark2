# Photo Watermark 2 - 详细实现方案

本文档旨在为 “Photo Watermark 2” 项目提供一份全面的技术实现方案和开发路线图。

## 1. 项目概述

开发一款功能强大且易于使用的桌面应用程序，允许用户在 Windows 和 macOS 平台上为图片添加文本或图片水印。应用将支持批量处理、实时预览和高度可定制的水印模板。

## 2. 技术选型

- **编程语言**: **Python 3.10+**
  - 理由：跨平台、拥有丰富的第三方库生态，开发效率高。
- **GUI 框架**: **PyQt5**
  - 理由：成熟的跨平台 GUI 框架，功能强大，社区支持广泛，能够构建专业的桌面应用界面。
- **图像处理库**: **Pillow (PIL Fork)**
  - 理由：Python 中最主流的图像处理库，功能全面，支持多种图像格式，性能可靠。
- **打包工具**: **PyInstaller**
  - 理由：能将 Python 应用打包成单文件可执行程序，方便在 Windows 和 macOS 上分发和运行。
- **版本控制**: **Git & GitHub**
  - 理由：用于代码托管、版本控制和协作，并按要求保留详细的提交记录。

## 3. 项目结构

为了保证代码的可维护性和扩展性，项目将采用以下模块化结构：

```
/LLM4SE-ImageWatermark2
|
|-- app/                     # 主应用目录
|   |-- assets/              # 存放图标、字体等静态资源
|   |-- core/                # 核心逻辑模块
|   |   |-- __init__.py
|   |   |-- image_processor.py # 图像处理、水印合成
|   |   |-- config_manager.py  # 水印模板的保存与加载
|   |
|   |-- ui/                  # UI界面模块
|   |   |-- __init__.py
|   |   |-- main_window.py     # 主窗口界面与交互逻辑
|   |   |-- widgets/           # 自定义UI控件 (如缩略图列表项)
|   |
|   |-- main.py              # 应用程序入口
|
|-- tests/                   # 单元测试目录 (可选)
|
|-- requirements.txt         # 项目依赖
|-- README.md                # 项目说明
|-- IMPLEMENTATION_PLAN.md   # 实现方案文档
```

## 4. 开发阶段与功能分解

项目将分为两个主要开发阶段，以确保核心功能的稳定交付，并逐步完善高级功能。

---

### **第一阶段：基础功能实现**

此阶段的目标是构建一个可用的基础版本，包含最核心的水印添加功能。

**4.1 项目初始化与环境配置**
- [ ] 创建上述项目目录结构。
- [ ] 初始化 Git 仓库。
- [ ] 创建并激活 Python 虚拟环境。
- [ ] 安装 `PyQt5` 和 `Pillow`，并生成 `requirements.txt`。

**4.2 基础 UI 框架**
- [ ] 使用 PyQt5 设计主窗口 (`main_window.py`)。
- [ ] **布局划分**:
    - **左侧面板**: 用于显示已导入图片的缩略图列表 (`QListWidget`)。
    - **中间面板**: 用于实时预览图片和水印效果 (`QGraphicsView`)。
    - **右侧面板**: 用于调整水印参数 (`QTabWidget` 或 `QScrollArea`)。
    - **底部区域**: 用于设置导出选项和执行导出操作。

**4.3 文件处理**
- [ ] **导入功能**:
    - 实现“导入图片”按钮，支持多选 (`QFileDialog`)。
    - 实现“导入文件夹”按钮。
    - 实现主窗口的拖拽导入功能。
    - 在左侧面板中显示导入图片的缩略图和文件名。
- [ ] **导出功能**:
    - 提供“导出”按钮，允许用户选择一个输出文件夹。
    - 实现逻辑，禁止导出到与原图相同的文件夹以防止覆盖。
    - 实现文件名自定义选项：保留原名、添加前缀、添加后缀。

**4.4 基础水印功能**
- [ ] **文本水印**:
    - 在右侧面板添加 `QLineEdit` 用于输入水印文本。
    - 添加 `QSlider` 用于调整文本透明度。
- [ ] **水印布局**:
    - 在右侧面板添加九宫格布局按钮，用于一键设置水印位置。
    - 在预览区域 (`QGraphicsView`) 中实现水印项的鼠标拖拽移动。
- [ ] **实时预览**:
    - 将所有UI控件的信号（如文本变化、滑块移动）连接到更新函数。
    - 每当参数改变时，调用 `image_processor.py` 中的函数重新生成带水印的预览图，并刷新中间的预览面板。

**4.5 配置管理**
- [ ] 实现程序关闭时自动保存当前的水印设置。
- [ ] 实现程序启动时自动加载上一次的设置。

---

### **第二阶段：高级功能开发**

此阶段将在一阶段的基础上，增加更多专业和人性化的功能，提升用户体验。

**4.6 高级文本水印样式 (可选)**
- [ ] **字体选择**: 添加 `QFontComboBox` 让用户选择系统字体。
- [ ] **字号与样式**: 添加 `QSpinBox` (字号)、`QPushButton` (粗体/斜体)。
- [ ] **颜色选择**: 添加按钮和 `QColorDialog` 以选择字体颜色。
- [ ] **阴影/描边**: 在 `image_processor.py` 中使用 Pillow 的高级绘图功能实现文本描边或阴影效果。

**4.7 图片水印 (可选)**
- [ ] 在右侧面板添加一个新 Tab 用于图片水印设置。
- [ ] 添加“选择图片”按钮，让用户导入一张图片作为水印。
- [ ] 添加滑块用于调整图片水印的大小和透明度。

**4.8 高级导出选项 (可选)**
- [ ] **JPEG 质量**: 如果输出格式为 JPEG，显示一个 `QSlider` 用于调节压缩率 (0-100)。
- [ ] **调整尺寸**: 添加选项允许用户在导出时按宽度、高度或百分比缩放图片。

**4.9 其他高级功能 (可选)**
- [ ] **水印旋转**: 添加 `QSlider` 或 `QSpinBox` 用于设置水印的旋转角度。
- [ ] **水印模板**:
    - 实现“保存为模板”功能，将当前所有水印参数保存到配置文件中。
    - 实现模板加载、管理（重命名、删除）功能。

---

## 5. 测试与打包

**5.1 测试**
- 对每个功能点进行单元测试和集成测试。
- 在 Windows 和 macOS 平台上进行兼容性测试。
- 关注性能，特别是批量处理大量图片时的响应速度和内存占用。

**5.2 打包与发布**
- 编写 `build.py` 脚本，使用 PyInstaller 自动化打包流程。
- 分别在 Windows 和 macOS 环境下生成可执行文件。
- 在 GitHub 上创建 Release，上传打包好的应用程序，并附上版本说明。

## 6. 交付物

- **GitHub 仓库**: 包含所有源代码、资源文件和详细的 commit 历史。
- **PDF 文件**: 包含指向 GitHub 仓库 URL 的链接。
- **GitHub Release**: 提供可直接下载和运行的 Windows (`.exe`) 和 macOS (`.app` 或 `.dmg`) 应用程序。
